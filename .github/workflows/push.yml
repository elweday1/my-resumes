# Secrets : CREDS, FOLDER_ID
# Requires: GCP Service Account to have write access to the folder
name: Render and Upload Resumes
on: [push]
env: 
  CREDS: ${{ secrets.CREDS }}
  FOLDER_ID: ${{ secrets.FOLDER_ID }}
  MY_NAME: Mohammed_Nasser
  MY_ROLE: SWE
  OUT_FILES: 
jobs:
  render-and-upload:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install typst
        run: sudo snap install typst

      - name: Render Resume Versions with Typst
        run: |
          MAIN_FILE=resumes/main.typ
          OUTPUT=resumes/${{ env.MY_NAME }}_${{ env.MY_ROLE }}_Resume
        
          ## Render default resume
          typst compile $MAIN_FILE ${OUTPUT}.pdf --input redacted=false
          
          ## Render redacted resume
          typst compile $MAIN_FILE ${OUTPUT}_Redacted.pdf --input redacted=true
        
      - name: Upload to Google Drive
        uses: adityak74/google-drive-upload-git-action@main
        with:
          filename: resumes/*.pdf
          credentials: ${{ env.CREDS }}
          folderId: ${{ env.FOLDER_ID }}
          overwrite: true