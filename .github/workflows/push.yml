# Secrets : CREDS, FOLDER_ID
# Requires: GCP Service Account to have write access to the folder
name: Render and Upload Resumes
on: [push]
env: 
  CREDS: ${{ secrets.CREDS }}
  FOLDER_ID: ${{ secrets.FOLDER_ID }}
  MY_NAME: Mohammed_Nasser
  MY_ROLE: SWE
  MAIN_FILE: resumes/main.typ
  OUT_FILES: resumes/*.pdf
jobs:
  render-and-upload:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install typst
        run: sudo snap install typst

      - name: Render Resume Versions with Typst
        run: |  
          ## Render default resume
          typst compile \ 
            resumes/main.typ \
            ${{ github.env.MY_NAME }}_${{ github.env.MY_ROLE }}_Resume.pdf \
            --input redacted=false
          
          ## Render redacted resume
          typst compile \
           resumes/main.typ \
           ${{ github.env.MY_NAME }}_${{ github.env.MY_ROLE }}_Resume_Redacted.pdf \
           --input redacted=true
        
      - name: Upload to Google Drive
        uses: adityak74/google-drive-upload-git-action@main
        with:
          filename: ${{ github.env.OUT_FILES }}
          credentials: ${{ github.env.CREDS }}
          folderId: ${{ github.env.FOLDER_ID }}
          overwrite: true